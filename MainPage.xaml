<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AirPlayStreamer.MainPage">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="30">

            <Label Text="Multi-Room Audio"
                   FontSize="32"
                   FontAttributes="Bold"
                   HorizontalOptions="Center" />

            <Label Text="Stream to HomePod + Echo Dot"
                   FontSize="16"
                   TextColor="Gray"
                   HorizontalOptions="Center" />

            <!-- Status -->
            <Frame BackgroundColor="#2d2d2d" Padding="15" CornerRadius="10">
                <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                    <Label x:Name="StatusIcon" Text="â—" TextColor="Gray" FontSize="16" />
                    <Label x:Name="StatusLabel" Text="Ready" TextColor="White" FontSize="14" />
                </HorizontalStackLayout>
            </Frame>

            <!-- Discovered Devices Section -->
            <Frame BackgroundColor="#1a1a2e" Padding="20" CornerRadius="15">
                <VerticalStackLayout Spacing="15">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Discovered Devices" FontSize="20" FontAttributes="Bold" TextColor="White" />
                        <Button x:Name="ScanButton"
                                Grid.Column="1"
                                Text="Scan"
                                Clicked="OnScanClicked"
                                BackgroundColor="#512BD4"
                                TextColor="White"
                                FontSize="14"
                                Padding="15,8"
                                CornerRadius="8" />
                    </Grid>

                    <!-- Loading indicator -->
                    <HorizontalStackLayout x:Name="ScanningIndicator" IsVisible="False" Spacing="10" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True" Color="#512BD4" HeightRequest="20" WidthRequest="20" />
                        <Label Text="Scanning for devices..." TextColor="Gray" FontSize="14" />
                    </HorizontalStackLayout>

                    <!-- Empty state -->
                    <Label x:Name="NoDevicesLabel"
                           Text="No devices found. Tap Scan to search."
                           TextColor="Gray"
                           FontSize="14"
                           HorizontalOptions="Center"
                           IsVisible="True" />

                    <!-- Device list -->
                    <CollectionView x:Name="DevicesList"
                                    ItemsSource="{Binding Devices}"
                                    SelectionMode="Single"
                                    SelectionChanged="OnDeviceSelected"
                                    IsVisible="False">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#2d2d30" Padding="15" Margin="0,5" CornerRadius="10" BorderColor="Transparent">
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                        <!-- Device icon -->
                                        <Frame BackgroundColor="#512BD4"
                                               WidthRequest="44" HeightRequest="44"
                                               CornerRadius="22" Padding="0"
                                               VerticalOptions="Center">
                                            <Label Text="{Binding DeviceIcon}"
                                                   FontSize="20"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Frame>

                                        <!-- Device info -->
                                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                            <Label Text="{Binding Name}" FontSize="16" FontAttributes="Bold" TextColor="White" />
                                            <Label Text="{Binding DeviceTypeDisplay}" FontSize="12" TextColor="Gray" />
                                        </VerticalStackLayout>

                                        <!-- Status indicator -->
                                        <Frame Grid.Column="2"
                                               BackgroundColor="{Binding StatusColor}"
                                               WidthRequest="12" HeightRequest="12"
                                               CornerRadius="6" Padding="0"
                                               VerticalOptions="Center" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- AirPlay Picker (Native) -->
            <Frame BackgroundColor="#1a1a2e" Padding="20" CornerRadius="15">
                <VerticalStackLayout Spacing="15">
                    <Label Text="AirPlay" FontSize="20" FontAttributes="Bold" TextColor="White" />
                    <Label Text="Use the native AirPlay picker to select output devices."
                           TextColor="Gray" FontSize="14" />

                    <Button x:Name="AirPlayButton"
                            Text="Open AirPlay Picker"
                            Clicked="OnAirPlayClicked"
                            BackgroundColor="#512BD4"
                            TextColor="White"
                            FontSize="16"
                            Padding="20,12"
                            CornerRadius="10" />
                </VerticalStackLayout>
            </Frame>

            <!-- Bluetooth -->
            <Frame BackgroundColor="#1a1a2e" Padding="20" CornerRadius="15">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Bluetooth" FontSize="20" FontAttributes="Bold" TextColor="White" />
                    <Label Text="Connect Echo Dot via Bluetooth. Say 'Alexa, pair' first."
                           TextColor="Gray" FontSize="14" />

                    <Button x:Name="BluetoothButton"
                            Text="Open Bluetooth Settings"
                            Clicked="OnBluetoothSettingsClicked"
                            BackgroundColor="#0078D4"
                            TextColor="White"
                            FontSize="16"
                            Padding="20,12"
                            CornerRadius="10" />
                </VerticalStackLayout>
            </Frame>

            <!-- Multi-Output (macOS only) -->
            <Frame x:Name="MultiOutputSection" BackgroundColor="#1a1a2e" Padding="20" CornerRadius="15">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Multi-Output (macOS)" FontSize="20" FontAttributes="Bold" TextColor="White" />
                    <Label Text="Combine AirPlay + Bluetooth into one output."
                           TextColor="Gray" FontSize="14" />

                    <Button x:Name="MultiOutputButton"
                            Text="Setup Multi-Output Device"
                            Clicked="OnMultiOutputClicked"
                            BackgroundColor="#107C10"
                            TextColor="White"
                            FontSize="16"
                            Padding="20,12"
                            CornerRadius="10" />
                </VerticalStackLayout>
            </Frame>

            <!-- Quick Actions -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                <Button Text="YouTube Music"
                        Clicked="OnYouTubeMusicClicked"
                        BackgroundColor="#FF0000"
                        TextColor="White"
                        FontSize="14"
                        Padding="15,12"
                        CornerRadius="10" />

                <Button Grid.Column="1"
                        Text="System Audio"
                        Clicked="OnSystemAudioClicked"
                        BackgroundColor="#6B7280"
                        TextColor="White"
                        FontSize="14"
                        Padding="15,12"
                        CornerRadius="10" />
            </Grid>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
